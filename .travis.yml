language: node_js
node_js:
- '10.10.0'
dist: trusty
sudo: true
cache:
  directories:
    - node_modules
addons:
  chrome: stable
before_install:
    - export CHROME_BIN=chromium-browser
    - export DISPLAY=:99.0
    - sh -e /etc/init.d/xvfb start
    - google-chrome-stable --headless --no-sandbox --disable-gpu --remote-debugging-port=9876 http://localhost &
install:
  - npm install
  # - npm install -g karma-cli
  # - npm install -g bower
env:
  global:
    - B_NAME1=develop
    - B_NAME2=master
    - B_NAME3=test
    #- GOOGLE_CHROME_BINARY=/usr/bin/google-chrome-beta
    #- if [ "$TRAVIS_BRANCH"=master]; then B_NAME=master; elif [ "$TRAVIS_BRANCH"=develop] then B_NAME=develop; else B_NAME=test; fi
    #- if [ "$TRAVIS_BRANCH"=develop]; then B_NAME=develop; fi
    #- if [ "$TRAVIS_BRANCH"=test]; then B_NAME=test; fi
before_script:
    - "sudo chown root /opt/google/chrome/chrome-sandbox"
    - "sudo chmod 4755 /opt/google/chrome/chrome-sandbox"
    - export CHROME_BIN=chromium-browser
    # Print build info that binary is compiled with.
    - echo $TRAVIS_COMMIT
    - echo $TRAVIS_TAG
    - echo $TRAVIS_BRANCH
    - echo $TRAVIS_BUILD_NUMBER
    - echo $B_NAME
script:
  - npm run build
  # - npm run test
  # - npm run lint

 # - xvfb-run npm run e2e
before_deploy:
    - if [ "$TRAVIS_BRANCH"=master ]; then B_NAME=master; fi
    #- if [ "$TRAVIS_BRANCH"=develop ]; then B_NAME=develop; fi
    #- if [ "$TRAVIS_BRANCH"=test ]; then B_NAME=test; fi
    #- echo $B_NAME
    - if [ "$TRAVIS_BRANCH" = master ]; then echo "master"; mv index_uat.html index.html; fi
    - if [ "$TRAVIS_BRANCH" = test ]; then echo "test"; mv index_staging.html index.html; fi
deploy:
  - provider: cloudfoundry
    edge: false
    username: nmdsdevopsserviceadm@hotmail.com
    password:
      secure: "mmMRcvA8s8DTISw6l2uVfU0nUrzIUZmhiwIie6ea9KaJsLUTgndFuTl6VaWYzRMpn6L95POaF5mjFHcn3mFHMDH52mkdj0QJzZv9ijpr5A2G69NueT9MsN+u/vYs08DDpVBHkfpwqgxYmlxVgz0bn9Gcfc3lsUFGik1/yPVlXJQmy4eCM3mxYdleYouzITRtrNkZQLUAVmooG+KO+nlHiTzIVhyNyhD6aFi/Lff/ncEAhk9i73/vFIaBfuHf+3ZmQStYo8VYyJAgf2uRYu/1iQ8qkXKACTw7RVCPdGy3gvoyapeWHLx3IJopPv2h5SZi12dTeqIxFEK8mnwl3s3XCMb86xrwI0YFLPWDUr0i3Zs3Zl8OJnOB71tE8r8zY6pGn/rmeVLjKiR8Pb3hfOVWFJKnZT2Y30wa8AlYi4+6uo013IWnJ2TjiRa9y6S/kbcjo8VGz416hXqraInBGKxTLrIQgcYm76EIHN5Wj+ImfKu7Cl3ym1lg2aENIwTu+DAAlG3VnQ4bt/IuCB9XVWT8mVcqVGearPAnEPnXzdl2AsPbX8q/4GuJFXm04Kp2s/R/QP0nNCeGVokjtGlT+QXr82lZ4jC6WbATsLg8ii4Sa3N8a5bJXfHYvaTd9t2BhS8Bkmh6N6R/Sr2rtjqg0Sb+hFfCQxJh9XmZ15HRapAyv7E="
    api: https://api.cloud.service.gov.uk
    organization: dhsc-skills-for-care-nmds-sc-2
    space: sandbox
    manifest: manifest.dev.yml
    on:
        branch: develop
  - provider: cloudfoundry
    edge: false
    username: nmdsdevopsserviceadm@hotmail.com
    password:
      secure: "mmMRcvA8s8DTISw6l2uVfU0nUrzIUZmhiwIie6ea9KaJsLUTgndFuTl6VaWYzRMpn6L95POaF5mjFHcn3mFHMDH52mkdj0QJzZv9ijpr5A2G69NueT9MsN+u/vYs08DDpVBHkfpwqgxYmlxVgz0bn9Gcfc3lsUFGik1/yPVlXJQmy4eCM3mxYdleYouzITRtrNkZQLUAVmooG+KO+nlHiTzIVhyNyhD6aFi/Lff/ncEAhk9i73/vFIaBfuHf+3ZmQStYo8VYyJAgf2uRYu/1iQ8qkXKACTw7RVCPdGy3gvoyapeWHLx3IJopPv2h5SZi12dTeqIxFEK8mnwl3s3XCMb86xrwI0YFLPWDUr0i3Zs3Zl8OJnOB71tE8r8zY6pGn/rmeVLjKiR8Pb3hfOVWFJKnZT2Y30wa8AlYi4+6uo013IWnJ2TjiRa9y6S/kbcjo8VGz416hXqraInBGKxTLrIQgcYm76EIHN5Wj+ImfKu7Cl3ym1lg2aENIwTu+DAAlG3VnQ4bt/IuCB9XVWT8mVcqVGearPAnEPnXzdl2AsPbX8q/4GuJFXm04Kp2s/R/QP0nNCeGVokjtGlT+QXr82lZ4jC6WbATsLg8ii4Sa3N8a5bJXfHYvaTd9t2BhS8Bkmh6N6R/Sr2rtjqg0Sb+hFfCQxJh9XmZ15HRapAyv7E="
    api: https://api.cloud.service.gov.uk
    organization: dhsc-skills-for-care-nmds-sc-2
    space: sandbox
    manifest: manifest.test.yml
    on:
        branch: test
  - provider: cloudfoundry
    edge: false
    username: nmdsdevopsserviceadm@hotmail.com
    password:
      secure: "mmMRcvA8s8DTISw6l2uVfU0nUrzIUZmhiwIie6ea9KaJsLUTgndFuTl6VaWYzRMpn6L95POaF5mjFHcn3mFHMDH52mkdj0QJzZv9ijpr5A2G69NueT9MsN+u/vYs08DDpVBHkfpwqgxYmlxVgz0bn9Gcfc3lsUFGik1/yPVlXJQmy4eCM3mxYdleYouzITRtrNkZQLUAVmooG+KO+nlHiTzIVhyNyhD6aFi/Lff/ncEAhk9i73/vFIaBfuHf+3ZmQStYo8VYyJAgf2uRYu/1iQ8qkXKACTw7RVCPdGy3gvoyapeWHLx3IJopPv2h5SZi12dTeqIxFEK8mnwl3s3XCMb86xrwI0YFLPWDUr0i3Zs3Zl8OJnOB71tE8r8zY6pGn/rmeVLjKiR8Pb3hfOVWFJKnZT2Y30wa8AlYi4+6uo013IWnJ2TjiRa9y6S/kbcjo8VGz416hXqraInBGKxTLrIQgcYm76EIHN5Wj+ImfKu7Cl3ym1lg2aENIwTu+DAAlG3VnQ4bt/IuCB9XVWT8mVcqVGearPAnEPnXzdl2AsPbX8q/4GuJFXm04Kp2s/R/QP0nNCeGVokjtGlT+QXr82lZ4jC6WbATsLg8ii4Sa3N8a5bJXfHYvaTd9t2BhS8Bkmh6N6R/Sr2rtjqg0Sb+hFfCQxJh9XmZ15HRapAyv7E="
    api: https://api.cloud.service.gov.uk
    organization: dhsc-skills-for-care-nmds-sc-2
    space: sandbox
    manifest: manifest.featureGDS.yml
    on:
        branch: develop_accessibility_demo
notifications:
    slack: skills-for-care:Co9S4WS4ZitevGOyBrEb6yEL
