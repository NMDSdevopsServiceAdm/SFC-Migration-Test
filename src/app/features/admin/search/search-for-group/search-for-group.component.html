<div class="govuk-grid-column-full">
  <div class="govuk-grid-row">
    <div class="govuk-grid-column-two-thirds">
      <p>Search by employer type. You can also choose to only search for parents.</p>
      <div *ngIf="submitted && !results.length" data-testid="no-search-results">
        <div class="govuk-warning-text">
          <span class="govuk-warning-text__icon" aria-hidden="true">!</span>
          <strong class="govuk-warning-text__text">
            <span class="govuk-warning-text__assistive">Information</span>
            Your search returned no results. Please refine your search criteria.
          </strong>
        </div>
      </div>
      <div *ngIf="results && results.length">
        <p class="govuk-!-font-weight-bold">
          Your search returned {{ results.length | number }} {{ results.length > 1 ? 'results' : 'result' }}
        </p>
        <table class="govuk-table" *ngIf="results && results.length" data-testid="group-search-results">
          <thead class="govuk-table__head">
            <tr class="govuk-table__row">
              <th class="govuk-table__header govuk-!-width-one-third" scope="col">Workplace</th>
              <th class="govuk-table__header" scope="col">Workplace ID</th>
              <th class="govuk-table__header" scope="col">Employer type</th>
              <th class="govuk-table__header" scope="col">&nbsp;</th>
            </tr>
          </thead>
          <tbody class="govuk-table__body">
            <ng-container *ngFor="let item of results; index as workplaceIndex">
              <tr class="govuk-table__row">
                <td class="govuk-table__cell">
                  <a (click)="navigateToWorkplace(item.uid, '', item.nmdsId, $event)" href="#">{{ item.name }}</a>
                </td>
                <td class="govuk-table__cell">{{ item.nmdsId || '-' }}</td>
                <td class="govuk-table__cell">
                  {{ item.employerType?.other ? item.employerType.other : item.employerType?.value || '-' }}
                </td>
                <td class="govuk-table__cell">
                  <a class="govuk-link--no-visited-state" href="#" (click)="toggleDetails(item.uid, $event)">{{
                    establishmentDetailsLabel[item.uid] ? establishmentDetailsLabel[item.uid] : 'Open'
                  }}</a>
                </td>
              </tr>
              <tr
                *ngIf="establishmentDetails[item.uid]"
                class="govuk-panel--gray"
                data-testid="groups-workplace-details"
              >
                <td colspan="6">
                  <div class="govuk-!-margin-2">
                    <table class="govuk-table">
                      <thead class="govuk-table__head">
                        <tr class="govuk-table__row">
                          <th class="govuk-table__header govuk-!-width-one-third" scope="col">Address</th>
                          <th class="govuk-table__header govuk-!-width-one-quarter" scope="col">Parent ID</th>
                          <th class="govuk-table__header govuk-!-width-one-quarter" scope="col">Regulated</th>
                          <th class="govuk-table__header" scope="col">Data Owner</th>
                        </tr>
                      </thead>
                      <tbody class="govuk-table__body">
                        <tr class="govuk-table__row govuk-util__vertical-align-top">
                          <td class="govuk-table__cell govuk-!-font-weight-regular">
                            {{ displayAddressForGroups(item) }}
                          </td>
                          <td class="govuk-table__cell govuk-!-font-weight-regular">
                            <ng-container *ngIf="item.parent?.nmdsId; else noParentID">
                              <a
                                (click)="navigateToWorkplace(item.parent.uid, '', item.parent.nmdsId, $event)"
                                href="#"
                                >{{ item.parent.nmdsId }}</a
                              >
                            </ng-container>

                            <ng-template #noParentID>-</ng-template>
                          </td>
                          <td class="govuk-table__cell govuk-!-font-weight-regular">
                            {{ item.isRegulated ? 'Yes' : 'No' }}
                          </td>
                          <td colspan="2" class="govuk-table__cell govuk-!-font-weight-regular">
                            {{ item.dataOwner }}
                          </td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                  <div class="govuk-!-margin-2" *ngIf="item.users?.length > 0">
                    <table class="govuk-table">
                      <thead class="govuk-table__head">
                        <tr class="govuk-table__row">
                          <th class="govuk-table__header govuk-!-width-one-third" scope="col">Users</th>
                          <th class="govuk-table__header govuk-!-width-one-quarter" scope="col">Security question</th>
                          <th class="govuk-table__header govuk-!-width-one-quarter" scope="col">Answer</th>
                          <th class="govuk-table__header" scope="col">Locked</th>
                        </tr>
                      </thead>
                      <tbody class="govuk-table__body">
                        <tr
                          class="govuk-table__row govuk-util__vertical-align-top"
                          *ngFor="let user of item.users; index as userIndex"
                        >
                          <td class="govuk-table__cell govuk-!-font-weight-regular">
                            {{ user.name }}
                          </td>
                          <td class="govuk-table__cell govuk-!-font-weight-regular">
                            {{ user.securityQuestion }}
                          </td>
                          <td class="govuk-table__cell govuk-!-font-weight-regular">
                            {{ user.securityAnswer }}
                          </td>
                          <td class="govuk-table__cell govuk-!-font-weight-regular">
                            <a
                              (click)="unlockWorkplaceUser(user.username, workplaceIndex, userIndex, $event)"
                              href="#"
                              *ngIf="user.isLocked; else notLocked"
                              >Yes, unlock</a
                            >
                            <ng-template #notLocked>No</ng-template>
                          </td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                </td>
              </tr>
            </ng-container>
          </tbody>
        </table>
      </div>
    </div>
    <div class="govuk-grid-column-one-third">
      <form #formEl novalidate (ngSubmit)="onSubmit()" [formGroup]="form">
        <div class="govuk-form-group">
          <label class="govuk-label" for="employerType"> Employer Type </label>
          <select class="govuk-select" id="employerType" name="employerType" [formControlName]="'employerType'">
            <option value="All">All</option>
            <option value="Local Authority (adult services)">Local Authority (adult services)</option>
            <option value="Local Authority (generic/other)">Local Authority (generic/other)</option>
            <option value="Private Sector">Private Sector</option>
            <option value="Voluntary / Charity">Voluntary / Charity</option>
            <option value="Other">Other</option>
          </select>
        </div>

        <div class="govuk-form-group">
          <div class="govuk-checkboxes">
            <div class="govuk-checkboxes__item">
              <input
                id="onlyParents"
                name="onlyParents"
                class="govuk-checkboxes__input"
                type="checkbox"
                value="true"
                [formControlName]="'onlyParents'"
              />
              <label class="govuk-label govuk-checkboxes__label" for="onlyParents"> Only search for parents </label>
            </div>
          </div>
        </div>
        <button type="submit" class="govuk-button" data-testid="searchButton">Search</button>
      </form>
    </div>
  </div>
</div>
